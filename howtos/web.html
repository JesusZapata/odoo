<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <title>Extendiendo la Interfaz. &mdash; documentación de odoo - 9.0</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/patchqueue.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <link rel="top" title="documentación de odoo - 9.0" href="../index.html" />
    <link rel="up" title="Tutoriales" href="../tutorials.html" />
    <link rel="next" title="Servicios Web (API)" href="../api_integration.html" />
    <link rel="prev" title="Construyendo un módulo" href="backend.html" /> 
  </head>
  <body><header class="">
    <figure class="card top">
      <span class="card-img" style="background-image: url('../_static/banners/build_interface_ext.jpg');"></span>
    </figure>
  </header>
  <nav id="main_navbar" class="navbar ">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".navbar-main">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <nav class="nav navbar-nav navbar-left">
          <li id="main-back"><a href="../index.html" class="mdi-navigation-arrow-back"></a></li>
          <li>
            <h1 id="main_title">Extendiendo la Interfaz.</h1>
          </li>
        </nav>
      </div>

      <nav class="collapse navbar-collapse navbar-main navbar-right" role="navigation">
        
        <ul class="current navbar-nav navbar-right nav"><li class="toctree-l1 current dropdown"><a data-toggle="dropdown" href="../tutorials.html" class="dropdown-toggle internal reference">Tutoriales</a><ul class="current dropdown-menu"><li class="toctree-l2"><a href="themes.html" class="internal reference">Haciendo un Tema</a></li><li class="toctree-l2"><a href="website.html" class="internal reference">Construyendo un Website</a></li><li class="toctree-l2"><a href="backend.html" class="internal reference">Construyendo un módulo</a></li><li class="current toctree-l2"><a href="" class="current internal reference">Extendiendo la Interfaz.</a></li></ul></li><li class="toctree-l1"><a href="../api_integration.html" class="internal reference">Servicios Web (API)</a><ul ></ul></li><li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../setup.html" class="dropdown-toggle internal reference">Setting Up</a><ul class="dropdown-menu"><li class="toctree-l2"><a href="../setup/install.html" class="internal reference">Installing Odoo</a></li><li class="toctree-l2"><a href="../setup/deploy.html" class="internal reference">Deploying Odoo</a></li><li class="toctree-l2"><a href="../setup/cdn.html" class="internal reference">Deploying with Content Delivery Networks</a></li><li class="toctree-l2"><a href="../setup/enterprise.html" class="internal reference">From Community to Enterprise</a></li></ul></li><li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../reference.html" class="dropdown-toggle internal reference">Referencia</a><ul class="dropdown-menu"><li class="toctree-l2"><a href="../reference/orm.html" class="internal reference">ORM API</a></li><li class="toctree-l2"><a href="../reference/data.html" class="internal reference">Data Files</a></li><li class="toctree-l2"><a href="../reference/actions.html" class="internal reference">Acciones</a></li><li class="toctree-l2"><a href="../reference/views.html" class="internal reference">Views</a></li><li class="toctree-l2"><a href="../reference/module.html" class="internal reference">Modules</a></li><li class="toctree-l2"><a href="../reference/cmdline.html" class="internal reference">Command-line interface: odoo.py</a></li><li class="toctree-l2"><a href="../reference/security.html" class="internal reference">Security in Odoo</a></li><li class="toctree-l2"><a href="../reference/testing.html" class="internal reference">Testing Modules</a></li><li class="toctree-l2"><a href="../reference/http.html" class="internal reference">Web Controllers</a></li><li class="toctree-l2"><a href="../reference/qweb.html" class="internal reference">QWeb</a></li><li class="toctree-l2"><a href="../reference/javascript.html" class="internal reference">Javascript</a></li><li class="toctree-l2"><a href="../reference/translations.html" class="internal reference">Translating Modules</a></li><li class="toctree-l2"><a href="../reference/reports.html" class="internal reference">QWeb Reports</a></li><li class="toctree-l2"><a href="../reference/workflows.html" class="internal reference">Workflows</a></li><li class="toctree-l2"><a href="../reference/guidelines.html" class="internal reference">Odoo Guidelines</a></li><li class="toctree-l2"><a href="../reference/upgrade_api.html" class="internal reference">Upgrade API</a></li></ul></li><li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../business.html" class="dropdown-toggle internal reference">Mementos de Negocio.</a><ul class="dropdown-menu"><li class="toctree-l2"><a href="https://odoo.com/documentation/functional/accounting.html" class="external reference">Accounting Memento (US GAAP)</a></li><li class="toctree-l2"><a href="https://odoo.com/documentation/functional/double-entry.html" class="external reference">Double-Entry Inventory</a></li><li class="toctree-l2"><a href="https://odoo.com/documentation/functional/valuation.html" class="external reference">Inventory Valuations</a></li></ul></li></ul>
      </nav>
    </div>
  </nav>
    
  
  <main class="container ">
    
    <div class="row">
      
      <aside>
        <div class="navbar-aside text-center">
          <div class="logo_box">
            <span class="logo"></span>
            Documentation
          </div>
          <ul class="list-group text-left nav"><li class="list-group-item"><a href="#a-simple-module" class="ripple internal reference">Un módulo Simple</a></li><li class="list-group-item"><a href="#odoo-javascript-module" class="ripple internal reference">Odoo módulo en JavaScript</a></li><li class="list-group-item"><a href="#classes" class="ripple internal reference">Clases</a></li><li class="list-group-item"><a href="#widgets-basics" class="ripple internal reference">Conceptos básicos de widgets</a><ul ><li class="list-group-item"><a href="#your-first-widget" class="ripple internal reference">Tu Widget</a></li><li class="list-group-item"><a href="#display-content" class="ripple internal reference">Mostrar Contenido</a></li><li class="list-group-item"><a href="#widget-parents-and-children" class="ripple internal reference">Los hijos y padres del widget</a></li><li class="list-group-item"><a href="#destroying-widgets" class="ripple internal reference">Destrucción de Widgets</a></li></ul></li><li class="list-group-item"><a href="#the-qweb-template-engine" class="ripple internal reference">El motor de la plantilla de QWeb</a><ul ><li class="list-group-item"><a href="#using-qweb" class="ripple internal reference">Utilizar QWeb</a><ul ><li class="list-group-item"><a href="#qweb-context" class="ripple internal reference">Contexto QWeb</a></li><li class="list-group-item"><a href="#template-declaration" class="ripple internal reference">Declaración de la plantilla</a></li><li class="list-group-item"><a href="#escaping" class="ripple internal reference">Escape</a></li><li class="list-group-item"><a href="#outputting-html" class="ripple internal reference">Produciendo HTML</a></li><li class="list-group-item"><a href="#conditionals" class="ripple internal reference">Condicionales</a></li><li class="list-group-item"><a href="#iteration" class="ripple internal reference">Iteración</a></li><li class="list-group-item"><a href="#defining-attributes" class="ripple internal reference">Definir atributos</a></li><li class="list-group-item"><a href="#calling-other-templates" class="ripple internal reference">Llamar a otras plantillas</a></li><li class="list-group-item"><a href="#to-learn-more-about-qweb" class="ripple internal reference">Para obtener más información acerca de la</a></li><li class="list-group-item"><a href="#exercise" class="ripple internal reference">Ejercicio</a></li></ul></li></ul></li><li class="list-group-item"><a href="#widget-helpers" class="ripple internal reference">Ayudantes de widget</a><ul ><li class="list-group-item"><a href="#widget-s-jquery-selector" class="ripple internal reference">JQuery Selector de <code >Widget</code></a></li><li class="list-group-item"><a href="#easier-dom-events-binding" class="ripple internal reference">Asignar eventos del DOM</a></li></ul></li><li class="list-group-item"><a href="#widget-events-and-properties" class="ripple internal reference">Propiedades y eventos de widget</a><ul ><li class="list-group-item"><a href="#events" class="ripple internal reference">Eventos</a></li><li class="list-group-item"><a href="#properties" class="ripple internal reference">Propiedades</a></li><li class="list-group-item"><a href="#id3" class="ripple internal reference">Ejercicio</a></li></ul></li><li class="list-group-item"><a href="#modify-existing-widgets-and-classes" class="ripple internal reference">Modificar las clases y los widgets existentes</a></li><li class="list-group-item"><a href="#translations" class="ripple internal reference">Traducciones</a></li><li class="list-group-item"><a href="#communication-with-the-odoo-server" class="ripple internal reference">Comunicación con el servidor de Odoo</a><ul ><li class="list-group-item"><a href="#contacting-models" class="ripple internal reference">Ponerse en contacto con modelos</a></li><li class="list-group-item"><a href="#compoundcontext" class="ripple internal reference">CompoundContext</a></li><li class="list-group-item"><a href="#queries" class="ripple internal reference">Consultas</a></li></ul></li><li class="list-group-item"><a href="#exercises" class="ripple internal reference">Ejercicios</a></li><li class="list-group-item"><a href="#existing-web-components" class="ripple internal reference">Existing web components</a><ul ><li class="list-group-item"><a href="#the-action-manager" class="ripple internal reference">The Action Manager</a><ul ><li class="list-group-item"><a href="#using-the-action-manager" class="ripple internal reference">Using the Action Manager</a></li></ul></li><li class="list-group-item"><a href="#client-actions" class="ripple internal reference">Client Actions</a></li><li class="list-group-item"><a href="#architecture-of-the-views" class="ripple internal reference">Architecture of the Views</a><ul ><li class="list-group-item"><a href="#the-view-manager" class="ripple internal reference">The View Manager</a></li><li class="list-group-item"><a href="#the-views" class="ripple internal reference">The Views</a></li></ul></li><li class="list-group-item"><a href="#the-form-view-fields" class="ripple internal reference">The Form View Fields</a><ul ><li class="list-group-item"><a href="#creating-a-new-type-of-field" class="ripple internal reference">Creating a New Type of Field</a><ul ><li class="list-group-item"><a href="#simple-read-only-field" class="ripple internal reference">Simple Read-Only Field</a></li><li class="list-group-item"><a href="#read-write-field" class="ripple internal reference">Read-Write Field</a></li></ul></li></ul></li><li class="list-group-item"><a href="#the-form-view-custom-widgets" class="ripple internal reference">The Form View Custom Widgets</a></li></ul></li></ul>
          
          <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/9.0/doc/howtos/web.rst" class="gith-link">
              Edit on GitHub
          </a></p>
          
        </div>
      </aside>
      
      <article class="doc-body ">
        
        
  <section id="building-interface-extensions"><p >Ésta guía es acerca de cómo crear módulos en la interfaz web de Odoo.</p><p >Para crear sitios web con Odoo, ver <a href="website.html" class="internal reference"><em >Construyendo un Website</em></a>; para añadir capacidades de negocio o ampliar sistemas de negocio existentes de Odoo, ver <a href="backend.html" class="internal reference"><em >Construyendo un módulo</em></a>.</p><div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p >Este manual supone los siguientes conocimientos previos:</p><ul ><li ><p >Conceptos básicos de JavaScript y buenas prácticas</p></li><li ><a href="http://jquery.org" class="external reference alert-link">jQuery</a></li><li ><a href="http://underscorejs.org" class="external reference alert-link">Underscore.js</a></li></ul><p >También requiere <a href="../setup/install.html#setup-install" class="internal alert-link reference"><em >tener Odoo instalado</em></a> y <a href="http://git-scm.com" class="external reference alert-link">Git</a>.</p></div></section><section id="a-simple-module"><h2 >Un módulo Simple</h2><p >Vamos a empezar con un sencillo módulo de Odoo manteniendo la configuración del componente web básico y dejarnos probar el framework web.</p><p >El módulo ejemplo está disponible en línea y puede descargarse usando el siguiente comando:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> git clone http://github.com/odoo/petstore
</pre></div>
</div>
<p >Esto creará una carpeta  <code >petstore</code> donde se ejecutó el comando. Entonces usted necesita agregar esa carpeta a de Odoo: opción:’ camino de addons <a href="../reference/cmdline.html#cmdoption-odoo.py--addons-path" class="internal reference"><code class="std xref std-option">addons path</code></a>, crear una nueva base de datos e instale el módulo de <code >oepetstore</code>.</p><p >Si navegas a la carpeta <code >petstore</code> , debería ver el siguiente contenido:</p><div class="highlight-text"><div class="highlight"><pre><span></span>oepetstore
|-- images
|   |-- alligator.jpg
|   |-- ball.jpg
|   |-- crazy_circle.jpg
|   |-- fish.jpg
|   `-- mice.jpg
|-- __init__.py
|-- oepetstore.message_of_the_day.csv
|-- __openerp__.py
|-- petstore_data.xml
|-- petstore.py
|-- petstore.xml
`-- static
    `-- src
        |-- css
        |   `-- petstore.css
        |-- js
        |   `-- petstore.js
        `-- xml
            `-- petstore.xml
</pre></div>
</div>
<p >El módulo tiene ya varias personalizaciones de servidor. Regresaremos a estos más adelante, por ahora vamos a centrarse en el contenido relacionado con la web, en la carpeta  <code >static</code>.</p><p >Los archivos utilizados en el lado de la “web” de un módulo Odoo deben colocarse en una carpeta <code >static</code> para que estén disponibles en un explorador web, archivos fuera de esa carpeta no pueden ser descargados por los navegadores. as subcarpetas son por convención y no es estrictamente necesaria <code >src/css</code>, <code >src/js</code> and <code >src/xml</code>.</p><dl ><dt ><code >oepetstore/static/css/petstore.css</code></dt><dd ><p >Actualmente vacío, contendrá los <a href="http://www.w3.org/Style/CSS/Overview.en.html" class="external reference">CSS</a> de la tienda de mascotas</p></dd><dt ><code >oepetstore/static/xml/petstore.xml</code></dt><dd ><p >En su mayor parte vacío, contendrá las plantillas <a href="../reference/qweb.html#reference-qweb" class="internal reference"><em >QWeb</em></a></p></dd><dt ><code >oepetstore/static/js/petstore.js</code></dt><dd ><p >La parte más importante (e interesante), contiene la lógica de la aplicación (o al menos del lado del navegador) como javascript. Actualmente debería verse como:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl><p >El cual sólo imprime un pequeño mensaje en la consola del explorador.</p><p >Los archivos en la carpeta <code >static</code>, es necesario sean definidos dentro del módulo para que puedan cargarse correctamente. Todo en <code >src/xml</code> se define en el archivo <code >__openerp__.py</code> mientras que los contenidos de <code >src/css</code> y <code >src/js</code> se definen <code >petstore.xml</code>, o un archivo similar.</p><div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p >Se concatenan todos los archivos JavaScript y <a href="../glossary.html#term-minified" class="internal alert-link reference"><em class="std std-term xref">minified</em></a> para mejorar la aplicación.</p><p >Es uno de lo inconveniente de depuración se hace más difícil como archivos individuales desaparecen y el código se hace significativamente menos legible. Es posible desactivar este proceso activando el “modo desarrollador”: inicie sesión en la instancia de Odoo (usuario <em >admin</em> contraseña * admin * por defecto) Abra el menú de usuario (en la esquina superior derecha de la pantalla de Odoo) y seleccione <em class="guilabel">About Odoo</em> entonces <em class="guilabel">Activar modo desarrollador</em>:</p><img src="../_images/about_odoo.png" class="img-responsive center-block"><img src="../_images/devmode.png" class="img-responsive center-block"><p >Esto volverá a cargar al cliente web con las optimizaciones deshabilitadas, lo que hará del desarrollo y su depuración mucho más cómodo.</p></div></section><section id="odoo-javascript-module"><h2 >Odoo módulo en JavaScript</h2><p >JavaScript no tiene módulos incorporados. Como resultado las variables definidas en archivos diferentes son todos tratadas juntas y pueden entrar en conflicto. Esto ha dado lugar a diversos patrones de módulo usados para construir los espacios de nombres limpios y limitar los riesgos de conflictos de nombres.</p><p >El esquema de desarrollo en Odoo utiliza un patrón para definir módulos web, para manejar los espacios de nombres y así cargarlos correctamente.</p><p ><code >oepetstore/static/js/petstore.js</code> contiene una declaración de módulo:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">local</span><span class="p">.</span><span class="nx">xxx</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">}</span>
</pre></div>
</div>
<p >En Odoo Web, los módulos están declarados como funciones de la variable global <code >openerp</code>. El nombre de la función debe ser la misma que el módulo (en este caso <code >oepetstore</code>) con lo que el esquema de desarrollo puede encontrarlo e inicializar automáticamente.</p><p >Cuando el cliente web se carga el módulo llama a la función raíz y envía dos parámetros:</p><ul ><li ><p >el primer parámetro es la instancia actual del cliente de web de Odoo, da acceso a varias de las capacidades definidas por Odoo (traducciones, servicios de red) así como de objetos definidos por la base o por otros módulos.</p></li><li ><p >el segundo parámetro es su propio espacio de nombres local creado automáticamente por el cliente web. Objetos y variables que deben ser accesibles desde fuera de su módulo (o bien porque el cliente de web de Odoo tiene que llamar a los otros para personalizarlos) deben ajustarse dentro de ese espacio de nombres.</p></li></ul></section><section id="classes"><h2 >Clases</h2><p >Mucho como módulos y contrario a lenguajes más orientados a objetos, javascript no construye <em >clases</em> <a href="#id4" class="footnote-ref" id="id1">1</a> aunque esto provee un mecanismo equivalente (si nivel más bajo y más detallado).</p><p >Por simplicidad y ayuda al desarrollador Odoo web ofrece un sistema de clases basado en  <a href="http://ejohn.org/blog/simple-javascript-inheritance/" class="external reference">Simple JavaScript Inheritance</a> de John Resig.</p><p >Se definen nuevas clases llamando al <code class="js-func xref js">extend()</code> método  <code class="js-class xref js">openerp.web.Class()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >El método <code class="js-func xref js">extend()</code> toma un diccionario que describe el contenido de la nueva clase (métodos y atributos estáticos). En este caso, sólo tendrá un método de <code >say_hello</code> que no toma parámetros.</p><p >Las clases se instancian utilizando el operador <code >new</code>::s</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello&quot; in the console</span>
</pre></div>
</div>
<p >Y atributos de la instancia pueden accederse a través de  <code >this</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span><span class="p">;</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
</div>
<p >Las clases pueden proporcionar un inicializador para realizar la configuración inicial de la instancia, mediante la definición de un método <code >init()</code>. El inicializador recibe los parámetros pasados al usar el operador <code >new</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
</div>
<p >También es posible crear subclases de las clases existentes (definido por el usuario) llamando al <code class="js-func xref js">extend()</code> en la clase padre, como se hace para hacer subclases <code class="js-class xref js">Class()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hola Bob&quot; in the console</span>
</pre></div>
</div>
<p >Cuando sobreescribes un método usando herencia, puede utilizar <code >this._super()</code> para llamar al método original:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;translation in Spanish: hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob \n translation in Spanish: hola Bob&quot; in the console</span>
</pre></div>
</div>
<div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p ><code >_super</code> no es un método estándar, es creado on-the-fly para el próximo método de la cadena actual de la herencia, si hay alguno. Sólo se define durante la parte <em >síncrona</em> de una llamada al método, para su uso en controladores asincrónicos (después llamadas de red o en las devoluciones de llamada <code >setTimeout</code>) una referencia a su valor será retenida, no debe accederse a través de <code >this</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// broken, will generate an error</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// correct</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// don&#39;t forget .bind()</span>
    <span class="kd">var</span> <span class="nx">_super</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></section><section id="widgets-basics"><h2 >Conceptos básicos de widgets</h2><p >El cliente web Odoo contiene <a href="http://jquery.org" class="external reference">jQuery</a> para una sencilla manipulación del DOM. Es útil y proporciona una API mejor que el estándar <a href="http://www.w3.org/TR/DOM-Level-3-Core/" class="external reference">W3C DOM</a><a href="#dombugs" class="footnote-ref" id="id2">2</a>, pero insuficiente para aplicaciones de estructura compleja complicando su mantenimiento.</p><p >Tal y como las herramientas de escritorio orientado a objetos herramientas de interfaz de usuario (por ejemplo <a href="http://qt-project.org" class="external reference">Qt</a>, <a href="https://developer.apple.com/technologies/mac/cocoa.html" class="external reference">Cocoa</a> o <a href="http://www.gtk.org" class="external reference">GTK</a>), Odoo Web hace componentes específicos responsables de las secciones de una página. En la web de Odoo, la base de dichos componentes es la clase <code class="js-class xref js">Widget()</code>, un componente especializado en el manejo de una sección de la página y mostrar información para el usuario.</p></section><section id="your-first-widget"><h3 >Tu Widget</h3><p >El módulo demostración inicial ya proporciona un widget básico:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Se extiende <code class="js-class xref js">Widget()</code> y reemplaza el método estándar <code class="js-func xref js">start()</code>, que — al igual que el anterior <code >MyClass</code> — hace poco por ahora.</p><p >Esta línea al final del archivo:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
    <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p >registra nuestro widget básico como una acción del cliente. Las acciones de cliente se explicará más adelante, por ahora esto es sólo lo que permite llamar a nuestro widget y que  aparezca cuando seleccionamos la <em class="menuselection">Pet Store ‣ Pet Store ‣ Home Page</em> menú.</p><div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p >ya que el widget se llama desde fuera de nuestro módulo, el cliente web necesita su nombre  &quot;fully qualified&quot;, no la versión local.</p></div></section><section id="display-content"><h3 >Mostrar Contenido</h3><p >Widgets tienen un número de características y métodos, pero los conceptos básicos son simples:</p><ul ><li ><p >crear un widget</p></li><li ><p >formatear los datos del widget</p></li><li ><p >Mostrar el widget</p></li></ul><p >El widget del <code >HomePage</code> ya tiene un método <code class="js-func xref js">start()</code>. Que el método es parte del ciclo de vida widget normal y automáticamente llaman una vez que se inserta el widget en la página. Podemos usarlo para visualizar algunos contenidos.</p><p >El widgets de todos tienen atributo <code class="js-attr xref js">$el</code>  que representa la sección de la página en la que está (como un objeto <a href="http://jquery.org" class="external reference">jQuery</a>). El contenido widget debe insertarse allí. Por defecto el atributo <code class="js-attr xref js">$el</code> es un <code >&lt;div&gt;</code> vacío.</p><p >El elemento <code >&lt;div&gt;</code> está generalmente invisible para el usuario si no tiene nada de contenido (o sin estilos específicos, no le dan un tamaño) razón por la cual nada se muestra en la página cuando el  <code >HomePage</code> el llamado.</p><p >Vamos a añadir algunos contenidos al elemento raíz del widget usando jQuery:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Este mensaje aparecerá cuando se abre <em class="menuselection">Pet Store ‣ Pet Store ‣ Home Page</em></p><div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >para actualizar el código javascript que se cargan en Odoo Web, solo necesitas volver a cargar la página. No hay que reiniciar el servidor de Odoo.</p></div><p >El widget del <code >HomePage</code> es utilizado por Odoo Web y gestionado automáticamente. Para aprender a usar un widget “desde cero“ vamos a crear uno nuevo:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;We are so happy to see you again in this menu!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Ahora podemos añadir nuestro  <code >GreetingsWidget</code> a la  <code >HomePage</code> mediante el uso de la función de <code >GreetingsWidget</code> llamada <code class="js-func xref js">appendTo()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<ul ><li ><p ><code >HomePage</code> primero agrega su propio contenido a la raíz DOM</p></li><li ><p ><code >HomePage</code> luego crea una instancia de  <code >GreetingsWidget</code></p></li><li ><p >Finalmente le dices <code >GreetingsWidget</code> donde insertarse, delegande parte de su <code class="js-attr xref js">$el</code> al <code >GreetingsWidget</code>.</p></li></ul><p >Cuando el método <code class="js-func xref js">appendTo()</code> es llamado, pide el widget insertarse en la posición especificada y mostrar su contenido. El método <code class="js-func xref js">start()</code> se llamará en la llamada al método <code class="js-func xref js">appendTo()</code>.</p><p >Para ver lo que sucede en la interfaz, usaremos el explorador de DOM. Pero primero vamos a modificar ligeramente nuestros widgets y de ésta manera más fácilmente los podremos encontrar, por:attr:[UNKNOWN NODE title_reference]:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_homepage&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
<span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_greetings&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Si puedes encontrar la sección relevante del DOM (haga clic derecho sobre el texto a continuación <em class="guilabel">Inspect Element</em>), debe tener lucir así:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Hello dear Odoo user!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;oe_petstore_greetings&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>We are so happy to see you again in this menu!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p >Que muestra claramente los dos elementos <code >&lt;div&gt;</code>  creados automáticamente por la <code class="js-class xref js">Widget()</code>, debido a que le hemos añadido un nombre a su clase.</p><p >También podemos ver los dos divs que añadimos nosotros mismos</p><p >Por último, tenga en cuenta que el elemento <code >&lt;div class=&quot;oe_petstore_greetings&quot;&gt;</code> representa la instancia <code >GreetingsWidget</code> que está dentro de <code >&lt;div class=&quot;oe_petstore_homepage&quot;&gt;</code> que representa la instancia <code >HomePage</code>, la cual lo agrega</p></section><section id="widget-parents-and-children"><h3 >Los hijos y padres del widget</h3><p >En la parte anterior, creamos una instancia de un widget usando esta sintaxis:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</pre></div>
</div>
<p >El primer argumento es <code >this</code>, que en ese caso fue una instancia de  <code >HomePage</code> . Esto indica que el widget se crea otro widget el cual es su <em >padre</em>.</p><p >Como hemos visto, widgets generalmente se insertan en el DOM por otro widget y <em >dentro</em> el elemento de raíz de otro widget. Esto significa que la mayoría de los widgets son “parte” de otro widget y existe en el nombre de él. Llamamos el contenedor el <em >padre</em> y el widget contenido el <em >hijo</em>.</p><p >Debido a múltiples razones técnicas y conceptuales, es necesaria para un widget saber quién es su padre y cuales son sus hijos.</p><dl ><dt ><code class="js-func xref js">getParent()</code></dt><dd ><p >puede utilizarse para obtener el padre de un widget:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getParent</span><span class="p">().</span><span class="nx">$el</span> <span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_homepage&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd><dt ><code class="js-func xref js">getChildren()</code></dt><dd ><p >puede utilizarse para obtener una lista de sus hijos:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$el</span><span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_greetings&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl><p >Al sobreescribir el método <code class="js-func xref js">init()</code> de un widget es <em >suma importancia</em> pasar el padre al llamar a <code >this._super()</code>, de lo contrario la relación no se configurará correctamente:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Por último, si un widget no tiene un padre (por ejemplo, porque es el widget de la raíz de la aplicación), <code >null</code> puede ser proporcionado como padre:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</pre></div>
</div>
</section><section id="destroying-widgets"><h3 >Destrucción de Widgets</h3><p >Si puede mostrar el contenido a los usuarios, también debería ser capaz de borrarlo. Esto se hace vía el método <code class="js-func xref js">destroy()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">greeting</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</pre></div>
</div>
<p >Cuando se destruye un widget primero llamará <code class="js-func xref js">destroy()</code> en todos sus hijos. Entonces borra del DOM. Si usted ha establecido estructuras permanentes en <code class="js-func xref js">init()</code> o <code class="js-func xref js">start()</code> que deban ser explícitamente limpiada (porque el recolector de basura no lo manejan), se puede reemplazar <code class="js-func xref js">destroy()</code>.</p><div role="alert" class="alert-danger alert"><p class="alert-title">Peligro</p><p >al sobreescribir <code class="js-func xref js">destroy()</code>, <code >_super()</code>  <em >debe siempre</em> sino el widget y sus hijos no se limpiarán correctamente hasta dejar fugas de memoria posible y “Eventos Fantasmas”, aunque no se muestra ningún error</p></div></section><section id="the-qweb-template-engine"><h2 >El motor de la plantilla de QWeb</h2><p >En la sección anterior agregamos contenido a nuestros widgets directamente manipulando (y agregando a) su DOM:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p >Esto permite generar y visualizar cualquier tipo de contenido, pero es difícil de manejar cuando se generan cantidades significativas de DOM (mucha duplicación, citando problemas,…)</p><p >Como muchos otros ambientes, solución de Odoo es utilizar un <a href="http://en.wikipedia.org/wiki/Web_template_system" class="external reference">motor de plantilla engine</a>. El motor de plantillas en Odoo se llama <a href="../reference/qweb.html#reference-qweb" class="internal reference"><em >QWeb</em></a>.</p><p >QWeb es un lenguaje de plantillas basado en XML, similar a <a href="http://en.wikipedia.org/wiki/Genshi_(templating_language)" class="external reference">Genshi</a>, <a href="http://en.wikipedia.org/wiki/Thymeleaf" class="external reference">Thymeleaf</a> o  <a href="http://en.wikipedia.org/wiki/Facelets" class="external reference">Facelets</a>. Este tiene las siguientes características:</p><ul ><li ><p >Se ha implementado completamente en JavaScript y es procesado en el navegador</p></li><li ><p >Cada archivo de plantilla (archivos XML) contiene varias plantillas</p></li><li ><p >Tiene un apoyo especial en la clase Odoo Web <code class="js-class xref js">Widget()</code>, aunque puede ser utilizado fuera de cliente de web de Odoo (y es posible utilizar <code class="js-class xref js">Widget()</code> sin depender de QWeb)</p></li></ul><div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >La razón de utilizar QWeb en vez de los motores de plantilla javascript es la extensibilidad de plantillas preexistentes (tercero), al igual que Odoo <a href="../reference/views.html#reference-views" class="internal alert-link reference"><em >views</em></a>.</p><p >La mayoría motores de plantilla javascript son basados en texto que impide la fácil extensibilidad estructural donde un motor de plantillas basado en XML puede ser genéricamente alterada por ejemeplo usando XPath o CSS y árbol-alteración DSL (o incluso sólo XSLT). Esta flexibilidad y extensibilidad es una característica del núcleo de Odoo y perderlo era considerado inaceptable.</p></div></section><section id="using-qweb"><h3 >Utilizar QWeb</h3><p >Primero vamos a definir una plantilla de QWeb simple en el archivo casi vacío <code >oepetstore/static/src/xml/petstore.xml</code>:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;background-color: red;&quot;</span><span class="nt">&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<p >Ahora podemos usar esta plantilla en el widget del <code >HomePage</code>. Utilizando la variable del cargador  <code >QWeb</code> en la parte superior de la página, podemos llamar a la plantilla definida en el archivo XML:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js-func xref js">QWeb.render()</code> busca la plantilla especifica, y la convierte a una cadena y devolviendo el resultado.</p><p >Sin embargo, porque <code class="js-class xref js">Widget()</code> tiene especial una integración de QWeb la plantilla se puede establecer directamente en el widget a través de su atributo <code class="js-attr xref js">template</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Aunque el resultado es similar, hay dos diferencias entre estos usos:</p><ul ><li ><p >de la segunda forma, la plantilla se procesa antes de que <code class="js-func xref js">start()</code> se llame</p></li><li ><p >en la primera versión el contenido de la plantilla se agrega al elemento de raíz del widget, mientras que en la segunda versión la raíz de la plantilla queda directamente <em >como</em> elemento de raíz del widget. Razón por la cual el sub-widget &quot;greetings&quot; también tiene un fondo rojo</p></li></ul><div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p >las plantillas deben tener un elemento de raíz única no-‘’ t’’, especialmente si está establecidos como un widget: attr:’~ openerp. Widget.template’. Si hay múltiples elementos de”raíz”, los resultados son indefinidos (generalmente solo se utilizará el primer elemento de la raíz y los demás serán ignorados)</p></div></section><section id="qweb-context"><h4 >Contexto QWeb</h4><p >A las plantillas QWeb le puedes pasar datos y éstos pueden contener lógica de visualización básicas.</p><p >Para las llamadas explícitas a <code class="js-func xref js">QWeb.render()</code>, los datos de la plantilla se pasan como segundo parámetro:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Klaus&quot;</span><span class="p">});</span>
</pre></div>
</div>
<p >con la plantilla para modificar:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >dará como resultado:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Hello Klaus<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p >Cuando se utiliza la integración con <code class="js-class xref js">Widget()</code> no es posible proporcionar datos adicionales a la plantilla. La plantilla se le dará una variable de contexto solo  <code >widget</code>, haciendo referencia al widget justo antes que <code class="js-func xref js">start()</code> se llame (el estado del widget será esencialmente lo que se instancia en el método <code class="js-func xref js">init()</code>):</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;widget.name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Mordecai&quot;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Resultado:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Hello Mordecai<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</section><section id="template-declaration"><h4 >Declaración de la plantilla</h4><p >Hemos visto cómo es el <em >procesamiento</em> de plantillas QWeb, ahora veamos la sintaxis de las plantillas de sí.</p><p >Una plantilla de QWeb se compone de XML regular mezclado con QWeb <em >directivas</em>. Se declara una directiva de QWeb con atributos XML que comiencen por ‘’ t-‘’.</p><p >La directiva más básica es <code >t-name</code>, se utiliza para declarar nuevas plantillas en un archivo de plantillas:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;templates&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<p ><code >t-name</code> toma el nombre de la plantilla que se está definiendo y declara que pueda llamarse usando <code class="js-func xref js">QWeb.render()</code>. Sólo se puede utilizar en el nivel superior de un archivo de plantilla.</p></section><section id="escaping"><h4 >Escape</h4><p >La directiva <code >t-esc</code> se puede utilizar para mostrar texto:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<p >Toma una expresión de Javascript que se evalúa, el resultado de la expresión es entonces insertado en el documento y escapado de HTML. Ya que es una expresión, es posible proporcionar sólo un nombre de variable como se ve arriba, o una expresión más compleja como un cálculo:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;3+5&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<p >o el método llama:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name.toUpperCase()&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
</section><section id="outputting-html"><h4 >Produciendo HTML</h4><p >Para inyectar HTML en la página durante el procesamiento, usas <code >t-raw</code>. Como <code >t-esc</code> toma una expresión Javascript arbitraria como parámetro, pero no realiza un paso de HTML-escape.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-raw=</span><span class="s">&quot;name.link(user_account)&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-danger alert"><p class="alert-title">Peligro</p><p ><code >t-raw</code> <em >no</em> se debe utilizar en datos que tener contener contenido proporcionado por el usuario no escapó como esto conduce a ‘cross-site scripting’ _ vulnerabilidades</p></div></section><section id="conditionals"><h4 >Condicionales</h4><p >QWeb puede tener bloques condicionales utilizando <code >t-if`. La Directiva toma una expresión arbitraria, si la expresión es falsa (``false</code>, <code >null</code>, <code >0</code>  o una cadena vacía) se suprime el bloque entero, de lo contrario se muestra.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == true&quot;</span><span class="nt">&gt;</span>
        true is true
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == false&quot;</span><span class="nt">&gt;</span>
        true is not true
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >QWeb no tiene un “else” de la estructura, utilice un segundo <code >t-if`</code> con la condición original invertida. Puede que desee guardar la condición en una variable local si se trata de una expresión compleja o costosa.</p></div></section><section id="iteration"><h4 >Iteración</h4><p >Para iterar sobre una lista, use <code >t-foreach</code> y  <code >t-as</code>. <code >t-foreach</code> toma una expresión devolviendo una lista sobre la que se itera y toma <code >t-as</code> para asignar el nombre de la variable para enlazar a cada elemento de la iteración.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;names&quot;</span> <span class="na">t-as=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p ><code >t-foreach</code> puede utilizarse con números y objetos (diccionarios)</p></div></section><section id="defining-attributes"><h4 >Definir atributos</h4><p >QWeb proporciona dos directivas relacionadas para definir atributos calculados: <code class="samp">t-att-<em >name</em></code> y <code class="samp">t-attf-<em >name</em></code>. En cualquier caso, <em >name</em> es el nombre del atributo a crear (por ejemplo, <code >t-att-id</code> define el atributo <code >id</code> después de la representación).</p><p ><code >t-att-</code> toma una expresión javascript cuyo resultado se define como el valor del atributo, que es más útil si todos el valor del atributo se calcula:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>
    Input your name:
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">t-att-value=</span><span class="s">&quot;defaultName&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p ><code >t-attf-</code> toma una <em >formato de cadena</em>. Una cadena de formato es texto literal con bloques de interpolación dentro de él, un bloque de interpolación es una expresión de javascript entre <code >{{</code> y <code >}}</code>, que será sustituido por el resultado de la expresión. Es más útil para los atributos que son parcialmente literales y parcialmente calculados como una clase:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">t-attf-class=</span><span class="s">&quot;container {{ left ? &#39;text-left&#39; : &#39;&#39; }} {{ extra_class }}&quot;</span><span class="nt">&gt;</span>
    insert content here
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
</section><section id="calling-other-templates"><h4 >Llamar a otras plantillas</h4><p >Las plantillas se pueden dividir en las plantillas (por simplicidad, mantenibilidad, reusabilidad o para evitar anidamiento excesivo markup).</p><p >Esto se hace usando la Directiva de ‘’ t-llamada ‘’, que toma el nombre de la plantilla para representar:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;A&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;B&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;B&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >representación de la plantilla de ‘’ una ‘’ resultará en:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p >Plantillas secundarias heredan el contexto de la representación de su persona.</p></section><section id="to-learn-more-about-qweb"><h4 >Para obtener más información acerca de la</h4><p >Para referenciasacerca de QWeb, vea :ref:[UNKNOWN NODE problematic]reference/qweb.</p></section><section id="exercise"><h4 >Ejercicio</h4><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Uso de QWeb en Widgets</p><p >Crear un widget cuyo constructor toma dos parámetros aparte de <code >padre</code>: <code >product_names</code> y <code >color</code>.</p><ul ><li ><p ><code >product_names</code> debe ser un arreglo de cadenas, cada una el nombre de un producto</p></li><li ><p ><code >color</code> es una cadena que contiene un color en CSS color formato (es decir: <code >#000000</code> para el negro).</p></li></ul><p >El widget debe mostrar los nombres de producto uno bajo el otro, cada uno en una caja aparte con un color de fondo con el valor de <code >color</code> y una frontera. Debe utilizar QWeb para representar el HTML. Cualquier CSS necesario debe estar en <code >oepetstore/static/src/css/petstore.css`</code>.</p><p >Utilice el widget en <code >HomePage</code> con media docena productos.</p></div></section><section id="widget-helpers"><h2 >Ayudantes de widget</h2></section><section id="widget-s-jquery-selector"><h3 >JQuery Selector de <code >Widget</code></h3><p >Seleccionar elementos del DOM en un widget puede realizarse llamando al método  <code >find()</code> en la raíz del DOM del widget:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
</pre></div>
</div>
<p >Pero como es una operación común, <code class="js-class xref js">Widget()</code> proporciona un acceso directo equivalente a través de la función <code class="js-func xref js">$()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p >La función de jQuery global <code >$()</code> <em >nunca</em> debe ser usada a menos que sea absolutamente necesario: la selección en la raíz de un widget son contextualizadas al widget, pero las selecciones con <code >$()</code> son globales a la página/aplicación y pueden coincidir con piezas de otros widgets y vistas, conduciendo a efectos secundarios peligrosos o no esperados. Desde un widget generalmente debes actuar solamente en la sección del DOM, no debería haber razón alguna para una selección global.</p></div></section><section id="easier-dom-events-binding"><h3 >Asignar eventos del DOM</h3><p >Previamente hemos enlazado eventos DOM usando controladores de eventos normales de jQuery (por ejemplo <code >.click()</code> o <code >.change()</code>) a elementos del widget:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.my_button&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">button_clicked</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Si bien esto funciona tiene algunos problemas:</p><ol ><li ><p >es más bien detallado</p></li><li ><p >no admite sustituir el elemento de raíz del widget en tiempo de ejecución sólo ya que solo se realiza la unión cuando  <code >start()</code> es ejecutado (durante la inicialización del widget)</p></li><li ><p >requiere tratar con los los problemas de <code >this</code>-binding</p></li></ol><p >Widgets proporcionan un acceso directo al enlace de eventos del DOM a través <code class="js-attr xref js">events</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;click .my_button&quot;</span><span class="o">:</span> <span class="s2">&quot;button_clicked&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js-attr xref js">events</code> es un objeto que enlaza un evento a una función o método para ser llamado cuando se dispara el evento:</p><ul ><li ><p >la clave es el nombre del evento, posiblemente refinado con un selector CSS en cuyo caso sólo si el evento ocurre en un elemento secundario la función se ejecutará: <code >click</code> se encargará de todos los clics dentro del widget, pero <code >click .my_button</code> ejecutará sólo el clic en elementos que tengan la clase <code >my_button</code></p></li><li ><p >el valor es la acción a realizar cuando se desencadena el evento</p><p >Puede ser una función:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* code here */</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p >o el nombre de un método en el objeto (ver ejemplo anterior).</p><p >En cualquier caso, <code >this</code> es la instancia del widget y el controlador pasa un solo parámetro, el <a href="http://api.jquery.com/category/events/event-object/" class="external reference">evento del objeto jQuery</a>.</p></li></ul></section><section id="widget-events-and-properties"><h2 >Propiedades y eventos de widget</h2></section><section id="events"><h3 >Eventos</h3><p >Widgets proporciona un sistema de evento (separado del sistema de eventos de DOM/jQuery descrito): un widget puede disparar eventos en sí mismo, y otros widgets (o a sí mismo) puedes atar a ellos mismos para dichos eventos:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button.ok_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="s1">&#39;click button.cancel_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Are you sure you want to perform this action?&lt;/div&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;ok_button&#39;&gt;Ok&lt;/button&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;cancel_button&#39;&gt;Cancel&lt;/button&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Este widget actúa como una fachada, transformando la entrada del usuario (a través de eventos de DOM) en un evento interno documentable al cual el widget padre se pueden enlazar.</p><p ><code class="js-func xref js">trigger()</code> toma el nombre del evento a accionar como primer argumento (obligatorio), los argumentos adicionales son tratados como datos del evento y los pasa directamente a los oyentes.</p><p >Entonces podemos establecer un evento padre instanciando nuestro widget genérico y escuchando al evento <code >elegido</code> utilizando <code class="js-func xref js">on()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;user_chose&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">user_chose</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">user_chose</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user agreed to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user refused to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js-func xref js">on()</code> enlaza una función que es llamada cuando el evento identificado por <code >event_name</code> sucede. El argumento de <code >func</code> es la función llamada y el <code >object</code> es el objeto a que está relacionado con esa función si se trata de un método. Se llamará la función enlazada con los argumentos adicionales de  <code class="js-func xref js">trigger()</code>  si tiene alguno. Ejemplo:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">my_event_triggered</span><span class="p">);</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">my_event_triggered</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="c1">// will print &quot;1 2 3&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >Desencadenar eventos en un widget de otros es generalmente una mala idea. La principal excepción a esta regla es <code >openerp.web.bus</code> que existe específicamente para eventos de las emisiones que pudiera estar interesado cualquier widget en todo Odoo Web.</p></div></section><section id="properties"><h3 >Propiedades</h3><p >Propiedades son muy similares a atributos normales de objetos que permiten almacenar datos en una instancia del widget, sin embargo tienen la característica adicional que desencadenan eventos cuando son almacenadas:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:name&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name_changed</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Nicolas&quot;</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">name_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The new value of the property &#39;name&#39; is&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<ul ><li ><p ><code class="js-func xref js">set()</code> establece el valor de una propiedad y desencadenadores <code class="samp">change:<em >propname</em></code> (donde <em >propname</em> es el nombre de propiedad que se pasa como primer parámetro <code class="js-func xref js">set()</code>) y <code >change</code></p></li><li ><p ><code class="js-func xref js">get()</code> recupera el valor de una propiedad.</p></li></ul></section><section id="id3"><h3 >Ejercicio</h3><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Eventos y propiedades del widget</p><p >Crea un widget  <code >ColorInputWidget</code> que desplegará 3 <code >&lt;input type=&quot;text&quot;&gt;</code>. Cada uno de dichos <code >&lt;input&gt;</code> es dedicado a un número hexadecimal de 00 a FF. Cuando cualquiera de esos <code >&lt;input&gt;``es modificado por el usuario el widget de consultar el contenido de esos tres ``&lt;input&gt;</code> concatenar sus valores y lograr un código CSS completo (por ejemplo <code >#00FF00</code>) y colocar el resultado en la propiedad llamada <code >color</code>. Considere que el evento jQuery <code >change()</code> puedes enlazarlo a cualquier elemento HTML <code >input()</code> y el método <code >val()</code> puede consultar el valor actual de dichos <code >&lt;input&gt;</code>, esto será útil para el ejercicio.</p><p >A continuación, modificar el widget <code >HomePage</code> para crear una instancia de  <code >ColorInputWidget</code> y mostrarla. El widget  <code >HomePage</code> también debe mostrar un rectángulo vacío. Ese rectángulo debe siempre, en cualquier momento tener el mismo color de fondo que el color en la propiedad de <code >ColorInputWidget</code> de la instancia de  <code >ColorInputWidget</code>.</p><p >Utilizar QWeb para generar todos los HTML.</p></div></section><section id="modify-existing-widgets-and-classes"><h2 >Modificar las clases y los widgets existentes</h2><p >El sistema de la clase de Odoo web permite la modificación directa de las clases existentes usando el método <code class="js-func xref js">include()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">TestClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">TestClass</span><span class="p">.</span><span class="nx">include</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; world&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">TestClass</span><span class="p">().</span><span class="nx">testMethod</span><span class="p">());</span>
<span class="c1">// will print &quot;hello world&quot;</span>
</pre></div>
</div>
<p >Este sistema es similar al mecanismo de la herencia, excepto que alterará la clase objetivo en el mismo lugar sin crear una nueva clase.</p><p >En este caso, <code >this._super()</code> llamará la implementación original del método siendo reemplazado/redefinido. Si la clase ya tenía sub clases, todas las llamadas a <code >this._super()</code> en las subclases llamará la nueva implementacion definida en la llamada <code class="js-func xref js">include()</code>. Esto también funcionará si algunas instancias de la clase (o de cualquiera de sus subclases) fueron creados antes de la llamada a <code class="js-func xref js">include()</code>.</p></section><section id="translations"><h2 >Traducciones</h2><p >El proceso de traducir texto en código Python y JavaScript es muy similar. Usted pudo haber notado estas líneas al principio del archivo <code >petstore.js</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
    <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
</pre></div>
</div>
<p >Estas líneas se utilizan simplemente para importar las funciones de traducción del módulo actual JavaScript. Se utilizan así:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello user!&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p >En Odoo, automáticamente se generan archivos de traducciones escaneando el código fuente. Toda pieza de código que llama a una función determinada se detectan y su contenido se agrega a un archivo de traducción que será enviado a los traductores. En Python, la función es <code >_()</code>. En JavaScript es la función <code class="js-func xref js">_t()</code> (y también <code class="js-func xref js">_lt()</code>).</p><p ><code >_t()</code> devolverá la traducción definida el texto que se da. Si ninguna traducción se define para que dicho texto, devuelve el texto original.</p><div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >Para inyectar valores proporcionado por el usuario en cadenas traducibles, es aconsejable utilizar <a href="http://gabceb.github.io/underscore.string.site/#sprintf" class="external reference alert-link">_.str.sprintf</a>  con los argumentos <em >después</em> de la traducción:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span>
    <span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello, %(user)s!&quot;</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;Ed&quot;</span>
<span class="p">}));</span>
</pre></div>
</div>
<p >Esto hace más legible las cadenas traducibles a los traductores y le da más flexibilidad para ordenar u omitir parámetros.</p></div><p ><code class="js-func xref js">_lt()</code> (&quot;lazy translate&quot;) es similar pero algo más complejo: en lugar de traducir inmediatamente su parámetro, devuelve un objeto que, cuando se convierte en una cadena, llevará a cabo la traducción.</p><p >Se utiliza para definir términos traducibles antes de que el sistema de traducción se inicialice, para atributos de la clase por ejemplo (como los módulos se cargan antes de que se configure el idioma del usuario y se descarguen las traducciones lo hace útil).</p></section><section id="communication-with-the-odoo-server"><h2 >Comunicación con el servidor de Odoo</h2></section><section id="contacting-models"><h3 >Ponerse en contacto con modelos</h3><p >La mayoría de las operaciones con Odoo implica comunicarse con <em >modelos</em> implementando operaciones de negocio, estos modelos luego (potencialmente) interactuaran con un motor de almacenamiento (generalmente <a href="http://en.wikipedia.org/wiki/PostgreSQL" class="external reference">PostgreSQL</a>).</p><p >Aunque <a href="http://jquery.org" class="external reference">jQuery</a> provee una función <a href="http://api.jquery.com/jquery.ajax/" class="external reference">$.ajax</a> para las interacciones de la red, comunicarse con Odoo requiere metadatos adicionales cuya configuración antes de cada llamada puede ser propensa a errores. Como resultado, Odoo web ofrece un método de comunicación primitiva de alto nivel.</p><p >Para demostrar esto, el archivo <code >petstore.py</code> contiene un modelo pequeño con un método ejemplo:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">message_of_the_day</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s2">&quot;oepetstore.message_of_the_day&quot;</span>

    <span class="nd">@api.model</span>
    <span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;hello&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">}</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
</pre></div>
</div>
<p >Esto declara un modelo con dos campos y un método <code >my_method()</code> que devuelve un diccionario literal.</p><p >Aquí está un widget ejemplo que llama a <code >my_method()</code> y muestra el resultado:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">);</span>
        <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
            <span class="c1">// will show &quot;Hello world&quot; to the user</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >La clase que llama modelos Odoo es <code class="js-class xref js">openerp.Model()</code>. Se crea una instancia con nombre del modelo en Odoo como primer parámetro (<code >oepetstore.message_of_the_day</code> aquí).</p><p ><code class="js-func xref js">call()</code> puede utilizarse para llamar a cualquier método (público) de un modelo de Odoo. Toma los siguientes argumentos posicionales:</p><dl ><dt ><code >name</code></dt><dd ><p >El nombre del método a llamar, <code >my_method</code></p></dd><dt ><code >args</code></dt><dd ><p >un arreglo de  <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">positional arguments</a> a proporcionar al método. Debido a que el ejemplo no tiene ningún argumento posicional para proporcionar, no se proporciona el parámetro <code >args</code>.</p><p >Aquí está otro ejemplo con argumentos posicionales:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
</div>
</dd><dt ><code >kwargs</code></dt><dd ><p >una asignación de <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">keyword arguments</a> a pasar. El ejemplo proporciona un solo argumento llamado <code >context</code>.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">c</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
</div>
</dd></dl><p ><code class="js-func xref js">call()</code> devuelve resuelta un diferido con el valor devuelto por el método del modelo como primer argumento.</p></section><section id="compoundcontext"><h3 >CompoundContext</h3><p >La sección anterior utiliza un argumento <code >context</code> que no fue explicado en la llamada al método:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()})</span>
</pre></div>
</div>
<p >El contexto es como un argumento “mágico” que el cliente web siempre le dará al servidor cuando se llama a un método. El contexto es un diccionario que contiene múltiples claves. Uno de los más importantes es el idioma del usuario, el servidor lo utiliza para traducir todos los mensajes de la aplicación. Otra es la zona horaria del usuario, utilizado para calcular correctamente las fechas y horarios si Odoo es utilizado por personas en diferentes países.</p><p >El  <code >argument</code> es necesario en todos los métodos, de lo contrario podrían suceden cosas malas (por ejemplo, la aplicación no será traducida correctamente). Es por eso que, cuando se llama un método de un modelo, usted siempre debe proporcionar ese argumento. La solución para lograrlo es utilizar <code class="js-class xref js">openerp.web.CompoundContext()</code>.</p><p ><code class="js-class xref js">CompoundContext()</code> es una clase que se utiliza para pasar el contexto del usuario (con el idioma, zona horaria, etc…) al servidor así como añadir nuevas llaves al contexto (algunos métodos del modelo usan llaves arbitrarias agregadas al contexto). Se crea dándole a su constructor a cualquier número de diccionarios u otra instancia de  <code class="js-class xref js">CompoundContext()</code>. Esto unirá los contextos antes de enviarlos al servidor.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">({</span><span class="s1">&#39;new_key&#39;</span><span class="o">:</span> <span class="s1">&#39;key_value&#39;</span><span class="p">})})</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span>
    <span class="o">//</span> <span class="n">will</span> <span class="k">print</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;new_key&#39;</span><span class="p">:</span> <span class="s1">&#39;key_value&#39;</span><span class="p">,</span> <span class="s1">&#39;tz&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe/Brussels&#39;</span><span class="p">,</span> <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p >Puedes ver el Diccionario en el argumento <code >context</code> el cual contiene algunas claves que están relacionados con la configuración del usuario actual en Odoo además de la tecla de la nueva llave  <code >new_key</code> agregada al instanciar <code class="js-class xref js">CompoundContext()</code>.</p></section><section id="queries"><h3 >Consultas</h3><p >Mientras que <code class="js-func xref js">call()</code> es suficiente para cualquier interacción con modelos Odoo, Odoo Web proporciona un ayudante para hacer consultas más simples a modelos (obtención de registros basados en diversas variantes): <code class="js-func xref js">query()</code> que actúa como un atajo para la combinación común de <a href="../reference/orm.html#openerp.models.Model.search" class="internal reference" title="openerp.models.Model.search"><code class="py py-meth xref">search()</code></a> y  :<a href="../reference/orm.html#openerp.models.Model.read" class="internal reference" title="openerp.models.Model.read"><code class="py py-meth xref">read()</code></a> . Éste provee una sintaxis más clara para buscar y leer modelos:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">])</span>
     <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]])</span>
     <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">all</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do work with users records</span>
<span class="p">});</span>
</pre></div>
</div>
<p >versus:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]],</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ids</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">]]);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do work with users records</span>
    <span class="p">});</span>
</pre></div>
</div>
<ul ><li ><p ><code class="js-func xref js">query()</code> toma una lista opcional de campos como parámetro (si no es proporcionado, se obtienen todos los campos del modelo). El cual devuelve un <a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">openerp.web.Query()</code></a> que puede ser personalizado antes de ser ejecutado</p></li><li ><p ><a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">Query()</code></a> representa la consulta que se está construyendo. Es inmutable, los métodos para personalizar la consulta realmente devuelven una copia modificada, por lo que es posible utilizar el original y la nueva versión lado a lado. Ver <a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">Query()</code></a> para sus opciones de personalización.</p></li></ul><p >Cuando la consulta está configurada como se desea, simplemente llame al <a href="../reference/javascript.html#openerp.web.Query.all" class="internal reference" title="openerp.web.Query.all"><code class="js-func xref js">all()</code></a> para ejecutarlo y devolver un diferido a su resultado. El resultado es el mismo que el del método <a href="../reference/orm.html#openerp.models.Model.read" class="internal reference" title="openerp.models.Model.read"><code class="py py-meth xref">read()</code></a>, es un conjunto de diccionarios donde cada diccionario es un registro solicitado, con cada campo solicitado como del diccionario.</p></section><section id="exercises"><h2 >Ejercicios</h2><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Mensaje del día</p><p >Crear un widget <code >MessageOfTheDay</code>  que muestre el último registro del modelo <code >oepetstore.message_of_the_day</code>. El widget debe obtener su registro tan pronto como se muestra.</p><p >Mostrar el widget en la página de la tienda de mascotas.</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Lista de juguetes para mascotas</p><p >Crear un widget <code >PetToysList</code> mostrando 5 juguetes (usando su nombre y sus imágenes).</p><p >Los juguetes para mascotas no se almacenan en un nuevo modelo, en su lugar se almacenan en la <code >product.product</code> con una categoría especial  <em >Pet Toys</em>. Podrás ver los juguetes previamente generados y añadir nuevos yendo a <em class="menuselection">Pet Store ‣ Pet Store ‣ Pet Toys</em>. Usted probablemente necesitará explorar <code >product.product</code> para crear el dominio adecuado para seleccionar juguetes correctos.</p><p >En Odoo, las imágenes se almacenan generalmente en campos regulares codificados como <a href="http://en.wikipedia.org/wiki/Base64" class="external reference alert-link">base64</a>, HTML soporta mostrar imágenes directamente base64 con <code class="samp">&lt;img src=&quot;data:<em >mime_type</em>;base64,<em >base64_image_data</em>&quot;/&gt;</code></p><p >El widget de  <code >PetToysList</code> debe ser exhibido en la página a la derecha del widget <code >MessageOfTheDay</code>. Usted necesitará hacer algún diseño con CSS para lograrlo.</p></div></section><section id="existing-web-components"><h2 >Existing web components</h2></section><section id="the-action-manager"><h3 >The Action Manager</h3><p >In Odoo, many operations start from an <a href="../reference/actions.html#reference-actions" class="internal reference"><em >action</em></a>:
opening a menu item (to a view), printing a report, ...</p><p >Actions are pieces of data describing how a client should react to the
activation of a piece of content. Actions can be stored (and read through a
model) or they can be generated on-the fly (locally to the client by
javascript code, or remotely by a method of a model).</p><p >In Odoo Web, the component responsible for handling and reacting to these
actions is the <em >Action Manager</em>.</p></section><section id="using-the-action-manager"><h4 >Using the Action Manager</h4><p >The action manager can be invoked explicitly from javascript code by creating
a dictionary describing <a href="../reference/actions.html#reference-actions" class="internal reference"><em >an action</em></a> of the right
type, and calling an action manager instance with it.</p><p ><code class="js-func xref js">do_action()</code> is a shortcut of <code class="js-class xref js">Widget()</code>
looking up the &quot;current&quot; action manager and executing the action:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">TestWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">dispatch_to_new_action</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s2">&quot;product.product&quot;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
            <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span>
            <span class="nx">context</span><span class="o">:</span> <span class="p">{},</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >The most common action <code >type</code> is <code >ir.actions.act_window</code> which provides
views to a model (displays a model in various manners), its most common
attributes are:</p><dl ><dt ><code >res_model</code></dt><dd >The model to display in views</dd><dt ><code >res_id</code> (optional)</dt><dd >For form views, a preselected record in <code >res_model</code></dd><dt ><code >views</code></dt><dd >Lists the views available through the action. A list of
<code >[view_id, view_type]</code>, <code >view_id</code> can either be the database identifier
of a view of the right type, or <code >false</code> to use the view by default for
the specified type. View types can not be present multiple times. The action
will open the first view of the list by default.</dd><dt ><code >target</code></dt><dd >Either <code >current</code> (the default) which replaces the &quot;content&quot; section of the
web client by the action, or <code >new</code> to open the action in a dialog box.</dd><dt ><code >context</code></dt><dd >Additional context data to use within the action.</dd></dl><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Jump to Product</p><p >Modify the <code >PetToysList</code> component so clicking on a toy replaces the
homepage by the toy's form view.</p></div></section><section id="client-actions"><h3 >Client Actions</h3><p >Throughout this guide, we used a simple <code >HomePage</code> widget which the web
client automatically starts when we select the right menu item. But how did
the Odoo web know to start this widget? Because the widget is registered as
a <em >client action</em>.</p><p >A client action is (as its name implies) an action type defined almost
entirely in the client, in javascript for Odoo web. The server simply sends
an action tag (an arbitrary name), and optionally adds a few parameters, but
beyond that <em >everything</em> is handled by custom client code.</p><p >Our widget is registered as the handler for the client action through this:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p ><code >instance.web.client_actions</code> is a <code class="js-class xref js">Registry()</code> in which
the action manager looks up client action handlers when it needs to execute
one. The first parameter of <code class="js-class xref js">add()</code> is the name
(tag) of the client action, and the second parameter is the path to the widget
from the Odoo web client root.</p><p >When a client action must be executed, the action manager looks up its tag
in the registry, walks the specified path and displays the widget it finds at
the end.</p><div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >a client action handler can also be a regular function, in whch case
it'll be called and its result (if any) will be interpreted as the
next action to execute.</p></div><p >On the server side, we had simply defined an <code >ir.actions.client</code> action:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;action_home_page&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.client&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;tag&quot;</span><span class="nt">&gt;</span>petstore.homepage<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p >and a menu opening the action:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;home_page_petstore_menu&quot;</span> <span class="na">parent=</span><span class="s">&quot;petstore_menu&quot;</span>
          <span class="na">name=</span><span class="s">&quot;Home Page&quot;</span> <span class="na">action=</span><span class="s">&quot;action_home_page&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</section><section id="architecture-of-the-views"><h3 >Architecture of the Views</h3><p >Much of Odoo web's usefulness (and complexity) resides in views. Each view
type is a way of displaying a model in the client.</p></section><section id="the-view-manager"><h4 >The View Manager</h4><p >When an <code >ActionManager</code> instance receive an action of type
<code >ir.actions.act_window</code>, it delegates the synchronization and handling of
the views themselves to a <em >view manager</em>, which will then set up one or
multiple views depending on the original action's requirements:</p><a href="../_images/viewarchitecture.svg" class="internal reference"><img src="../_images/viewarchitecture.svg" class="img-responsive center-block"></a></section><section id="the-views"><h4 >The Views</h4><p >Most <a href="../reference/views.html#reference-views" class="internal reference"><em >Odoo views</em></a> are implemented through a subclass
of <code class="js-class xref js">openerp.web.View()</code> which provides a bit of generic basic structure
for handling events and displaying model information.</p><p >The <em >search view</em> is considered a view type by the main Odoo framework, but
handled separately by the web client (as it's a more permanent fixture and
can interact with other views, which regular views don't do).</p><p >A view is responsible for loading its own description XML (using
<a href="../reference/orm.html#openerp.models.Model.fields_view_get" class="internal reference" title="openerp.models.Model.fields_view_get"><code class="py xref py-class">fields_view_get</code></a>) and any other data source
it needs. To that purpose, views are provided with an optional view
identifier set as the <code class="js-attr xref js">view_id</code> attribute.</p><p >Views are also provided with a <code class="js-class xref js">DataSet()</code> instance which
holds most necessary model information (the model name and possibly various
record ids).</p><p >Views may also want to handle search queries by overriding
<code class="js-func xref js">do_search()</code>, and updating their
<code class="js-class xref js">DataSet()</code> as necessary.</p></section><section id="the-form-view-fields"><h3 >The Form View Fields</h3><p >A common need is the extension of the web form view to add new ways of
displaying fields.</p><p >All built-in fields have a default display implementation, a new
form widget may be necessary to correctly interact with a new field type
(e.g. a <a href="../glossary.html#term-gis" class="internal reference"><em class="std std-term xref">GIS</em></a> field) or to provide new representations and ways to
interact with existing field types (e.g. validate
<a href="../reference/orm.html#openerp.fields.Char" class="internal reference" title="openerp.fields.Char"><code class="py xref py-class">Char</code></a> fields which should contain email addresses
and display them as email links).</p><p >To explicitly specify which form widget should be used to display a field,
simply use the <code >widget</code> attribute in the view's XML description:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contact_mail&quot;</span> <span class="na">widget=</span><span class="s">&quot;email&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><ul ><li >the same widget is used in both &quot;view&quot; (read-only) and &quot;edition&quot; modes
of a form view, it's not possible to use a widget in one and an other
widget in the other</li><li >and a given field (name) can not be used multiple times in the same form</li><li >a widget may ignore the current mode of the form view and remain the
same in both view and edition</li></ul></div><p >Fields are instantiated by the form view after it has read its XML description
and constructed the corresponding HTML representing that description. After
that, the form view will communicate with the field objects using some
methods. These methods are defined by the <code >FieldInterface</code>
interface. Almost all fields inherit the <code >AbstractField</code> abstract
class. That class defines some default mechanisms that need to be implemented
by most fields.</p><p >Here are some of the responsibilities of a field class:</p><ul ><li >The field class must display and allow the user to edit the value of the field.</li><li ><p >It must correctly implement the 3 field attributes available in all fields
of Odoo. The <code >AbstractField</code> class already implements an algorithm that
dynamically calculates the value of these attributes (they can change at any
moment because their value change according to the value of other
fields). Their values are stored in <em >Widget Properties</em> (the widget
properties were explained earlier in this guide). It is the responsibility
of each field class to check these widget properties and dynamically adapt
depending of their values. Here is a description of each of these
attributes:</p><ul ><li ><code >required</code>: The field must have a value before saving. If <code >required</code>
is <code >true</code> and the field doesn't have a value, the method
<code >is_valid()</code> of the field must return <code >false</code>.</li><li ><code >invisible</code>: When this is <code >true</code>, the field must be invisible. The
<code >AbstractField</code> class already has a basic implementation of this
behavior that fits most fields.</li><li ><code >readonly</code>: When <code >true</code>, the field must not be editable by the
user. Most fields in Odoo have a completely different behavior depending
on the value of <code >readonly</code>. As example, the <code >FieldChar</code> displays an
HTML <code >&lt;input&gt;</code> when it is editable and simply displays the text when
it is read-only. This also means it has much more code it would need to
implement only one behavior, but this is necessary to ensure a good user
experience.</li></ul></li><li >Fields have two methods, <code >set_value()</code> and <code >get_value()</code>, which are
called by the form view to give it the value to display and get back the new
value entered by the user. These methods must be able to handle the value as
given by the Odoo server when a <code >read()</code> is performed on a model and give
back a valid value for a <code >write()</code>.  Remember that the JavaScript/Python
data types used to represent the values given by <code >read()</code> and given to
<code >write()</code> is not necessarily the same in Odoo. As example, when you read a
many2one, it is always a tuple whose first value is the id of the pointed
record and the second one is the name get (ie: <code >(15, &quot;Agrolait&quot;)</code>). But
when you write a many2one it must be a single integer, not a tuple
anymore. <code >AbstractField</code> has a default implementation of these methods
that works well for simple data type and set a widget property named
<code >value</code>.</li></ul><p >Please note that, to better understand how to implement fields, you are
strongly encouraged to look at the definition of the <code >FieldInterface</code>
interface and the <code >AbstractField</code> class directly in the code of the Odoo web
client.</p></section><section id="creating-a-new-type-of-field"><h4 >Creating a New Type of Field</h4><p >In this part we will explain how to create a new type of field. The example
here will be to re-implement the <code >FieldChar</code> class and progressively explain
each part.</p></section><section id="simple-read-only-field"><h5 >Simple Read-Only Field</h5><p >Here is a first implementation that will only display text. The
user will not be able to modify the content of the field.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p >In this example, we declare a class named <code >FieldChar2</code> inheriting from
<code >AbstractField</code>. We also register this class in the registry
<code >instance.web.form.widgets</code> under the key <code >char2</code>. That will allow us to
use this new field in any form view by specifying <code >widget=&quot;char2&quot;</code> in the
<code >&lt;field/&gt;</code> tag in the XML declaration of the view.</p><p >In this example, we define a single method: <code >render_value()</code>. All it does is
display the widget property <code >value</code>.  Those are two tools defined by the
<code >AbstractField</code> class. As explained before, the form view will call the
method <code >set_value()</code> of the field to set the value to display. This method
already has a default implementation in <code >AbstractField</code> which simply sets
the widget property <code >value</code>. <code >AbstractField</code> also watch the
<code >change:value</code> event on itself and calls the <code >render_value()</code> when it
occurs. So, <code >render_value()</code> is a convenience method to implement in child
classes to perform some operation each time the value of the field changes.</p><p >In the <code >init()</code> method, we also define the default value of the field if
none is specified by the form view (here we assume the default value of a
<code >char</code> field should be an empty string).</p></section><section id="read-write-field"><h5 >Read-Write Field</h5><p >Read-only fields, which only display content and don't allow the
user to modify it can be useful, but most fields in Odoo also allow editing.
This makes the field classes more complicated, mostly because fields are
supposed to handle both editable and non-editable mode, those modes are
often completely different (for design and usability purpose) and the fields
must be able to switch between modes at any moment.</p><p >To know in which mode the current field should be, the <code >AbstractField</code> class
sets a widget property named <code >effective_readonly</code>. The field should watch
for changes in that widget property and display the correct mode
accordingly. Example:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldChar2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldChar2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_char2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >In the <code >start()</code> method (which is called immediately after a widget has been
appended to the DOM), we bind on the event <code >change:effective_readonly</code>. That
allows us to redisplay the field each time the widget property
<code >effective_readonly</code> changes. This event handler will call
<code >display_field()</code>, which is also called directly in <code >start()</code>. This
<code >display_field()</code> was created specifically for this field, it's not a method
defined in <code >AbstractField</code> or any other class. We can use this method
to display the content of the field depending on the current mode.</p><p >From now on the conception of this field is typical, except there is a
lot of verifications to know the state of the <code >effective_readonly</code> property:</p><ul ><li >In the QWeb template used to display the content of the widget, it displays
an <code >&lt;input type=&quot;text&quot; /&gt;</code> if we are in read-write mode and nothing in
particular in read-only mode.</li><li >In the <code >display_field()</code> method, we have to bind on the <code >change</code> event
of the <code >&lt;input type=&quot;text&quot; /&gt;</code> to know when the user has changed the
value. When it happens, we call the <code >internal_set_value()</code> method with the
new value of the field. This is a convenience method provided by the
<code >AbstractField</code> class. That method will set a new value in the <code >value</code>
property but will not trigger a call to <code >render_value()</code> (which is not
necessary since the <code >&lt;input type=&quot;text&quot; /&gt;</code> already contains the correct
value).</li><li >In <code >render_value()</code>, we use a completely different code to display the
value of the field depending if we are in read-only or in read-write mode.</li></ul><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Create a Color Field</p><p >Create a <code >FieldColor</code> class. The value of this field should be a string
containing a color code like those used in CSS (example: <code >#FF0000</code> for
red). In read-only mode, this color field should display a little block
whose color corresponds to the value of the field. In read-write mode, you
should display an <code >&lt;input type=&quot;color&quot; /&gt;</code>. That type of <code >&lt;input /&gt;</code>
is an HTML5 component that doesn't work in all browsers but works well in
Google Chrome. So it's OK to use as an exercise.</p><p >You can use that widget in the form view of the <code >message_of_the_day</code>
model for its field named <code >color</code>. As a bonus, you can change the
<code >MessageOfTheDay</code> widget created in the previous part of this guide to
display the message of the day with the background color indicated in the
<code >color</code> field.</p></div></section><section id="the-form-view-custom-widgets"><h3 >The Form View Custom Widgets</h3><p >Form fields are used to edit a single field, and are intrinsically linked to
a field. Because this may be limiting, it is also possible to create
<em >form widgets</em> which are not so restricted and have less ties to a specific
lifecycle.</p><p >Custom form widgets can be added to a form view through the <code >widget</code> tag:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;widget</span> <span class="na">type=</span><span class="s">&quot;xxx&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p >This type of widget will simply be created by the form view during the
creation of the HTML according to the XML definition. They have properties in
common with the fields (like the <code >effective_readonly</code> property) but they are
not assigned a precise field. And so they don't have methods like
<code >get_value()</code> and <code >set_value()</code>. They must inherit from the <code >FormWidget</code>
abstract class.</p><p >Form widgets can interact with form fields by listening for their changes and
fetching or altering their values. They can access form fields through
their <code class="js-attr xref js">field_manager</code> attribute:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetMultiplication</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_a&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_b&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_result</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_a&quot;</span><span class="p">)</span> <span class="o">*</span>
                     <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_b&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;a*b = &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;multiplication&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetMultiplication&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p ><code class="js-attr xref js">FormWidget</code> is generally the
<code class="js-class xref js">FormView()</code> itself, but features used from it should
be limited to those defined by <code class="js-class xref js">FieldManagerMixin()</code>,
the most useful being:</p><ul ><li ><code class="js-func xref js">get_field_value(field_name)()</code>
which returns the value of a field.</li><li ><code class="js-func xref js">set_values(values)()</code> sets multiple
field values, takes a mapping of <code >{field_name: value_to_set}</code></li><li >An event <code class="samp">field_changed:<em >field_name</em></code> is triggered any time the value
of the field called <code >field_name</code> is changed</li></ul><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Show Coordinates on Google Map</p><p >Add two fields to <code >product.product</code> storing a latitude and a longitude,
then create a new form widget to display the latitude and longitude of
a product's origin on a map</p><p >To display the map, use Google Map's embedding:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;400&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;300&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll=XXX,YYY&amp;amp;output=embed&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</pre></div>
</div>
<p >where <code >XXX</code> should be replaced by the latitude and <code >YYY</code> by the
longitude.</p><p >Display the two position fields and a map widget using them in a new
notebook page of the product's form view.</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Get the Current Coordinate</p><p >Add a button resetting the product's coordinates to the location of the
user, you can get these coordinates using the
<a href="http://diveintohtml5.info/geolocation.html" class="external reference alert-link">javascript geolocation API</a>.</p><p >Now we would like to display an additional button to automatically set the
coordinates to the location of the current user.</p><p >To get the coordinates of the user, an easy way is to use the geolocation
JavaScript API.  <a href="http://www.w3schools.com/html/html5_geolocation.asp" class="external reference alert-link">See the online documentation to know how to use it</a>.</p><p >Please also note that the user should not be able to
click on that button when the form view is in read-only mode. So, this
custom widget should handle correctly the <code >effective_readonly</code> property
just like any field. One way to do this would be to make the button
disappear when <code >effective_readonly</code> is true.</p></div><div class="footnote" id="id4"><span class="footnote-label"><a class="footnote-backref" href="#id1">[1]</a></span> as a separate concept from instances. In many languages classes
are full-fledged objects and themselves instance (of
metaclasses) but there remains two fairly separate hierarchies
between classes and instances</div><div class="footnote" id="dombugs"><span class="footnote-label"><a class="footnote-backref" href="#id2">[2]</a></span> as well as papering over cross-browser differences, although
this has become less necessary over time</div></section>

      </article>
    </div>
    
    <div id="mask"></div>
  </main>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
  </body>
</html>